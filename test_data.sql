-- ============================================
-- GoodServices 测试数据导入脚本
-- ============================================
-- 版本：v1.0
-- 日期：2025-11-18
-- 用途：为开发测试环境导入完整测试数据集
-- ============================================

USE goodservices;

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ============================================
-- 0. 数据清理（开发环境，谨慎使用）
-- ============================================
-- 清除现有数据但保留表结构，用于重新导入测试数据
TRUNCATE TABLE accept_info;
TRUNCATE TABLE response_info;
TRUNCATE TABLE sr_info;
TRUNCATE TABLE buser_table;

-- ============================================
-- 1. 初始化城市信息（如不存在）
-- ============================================
-- 说明：城市信息来自中国城市编码标准
INSERT IGNORE INTO city_info (cityID, cityName, provinceID, provinceName) VALUES
(110100, '北京市', 11, '北京'),
(310100, '上海市', 31, '上海'),
(440100, '广州市', 44, '广东'),
(440300, '深圳市', 44, '广东'),
(330100, '杭州市', 33, '浙江'),
(210100, '沈阳市', 21, '辽宁');

-- ============================================
-- 2. 初始化服务类型（如不存在）
-- ============================================
-- 说明：服务类型已在原数据库中，此处为确保完整性
INSERT IGNORE INTO service_type (id, typename) VALUES
(1, '管道维修'),
(2, '助老服务'),
(3, '保洁服务'),
(4, '就诊服务'),
(5, '营养餐服务'),
(6, '定期接送服务');

-- ============================================
-- 3. 创建测试用户（5个）
-- ============================================
-- 说明：
-- - 所有密码使用BCrypt加密（密码原文：Pass123）
-- - BCrypt哈希：$2b$12$LQv3c1yqBWVHxkd0LHAkCOYz6TtxMQJqhN8/LewY5lW5q3Zm3qXHu
-- - 用户类型：服务消费者 + 服务提供者（双重角色）
-- - 用户级别：默认为普通用户，可扩展为VIP等

INSERT INTO buser_table
(uname, ctype, idno, bname, bpwd, phoneNo, rdate, userlvl, `desc`) VALUES
('user_zhang', '身份证', '110101199001011234', '张三', '$2b$12$LQv3c1yqBWVHxkd0LHAkCOYz6TtxMQJqhN8/LewY5lW5q3Zm3qXHu', '13801111111', NOW(), '普通用户', '热心市民，积极参与社区服务'),
('user_li', '身份证', '110101199002021234', '李四', '$2b$12$LQv3c1yqBWVHxkd0LHAkCOYz6TtxMQJqhN8/LewY5lW5q3Zm3qXHu', '13802222222', NOW(), '普通用户', '专业水管工，有10年工作经验'),
('user_wang', '身份证', '110101199003031234', '王五', '$2b$12$LQv3c1yqBWVHxkd0LHAkCOYz6TtxMQJqhN8/LewY5lW5q3Zm3qXHu', '13803333333', NOW(), '普通用户', '保洁服务专家，承接家庭/办公室保洁'),
('user_zhao', '身份证', '110101199004041234', '赵六', '$2b$12$LQv3c1yqBWVHxkd0LHAkCOYz6TtxMQJqhN8/LewY5lW5q3Zm3qXHu', '13804444444', NOW(), '普通用户', '养老护理员，具有护理资格证'),
('user_sun', '身份证', '110101199005051234', '孙七', '$2b$12$LQv3c1yqBWVHxkd0LHAkCOYz6TtxMQJqhN8/LewY5lW5q3Zm3qXHu', '13805555555', NOW(), '普通用户', '医疗健康顾问，可提供咨询建议');

-- ============================================
-- 4. 创建服务需求记录（12条）
-- ============================================
-- 说明：
-- - psr_userid：发布用户ID（来自buser_table）
-- - ps_state：0=已发布，-1=已取消
-- - cityID：所在城市
-- - stype_id：服务类型
-- - ps_begindate：发布日期
-- - file_list：关联的文件（演示用）

-- 用户1（张三）发布4条需求
INSERT INTO sr_info
(sr_title, stype_id, psr_userid, cityID, `desc`, file_list, ps_begindate, ps_state) VALUES
('厨房水管漏水急需维修', 1, 1, 110100, '厨房水管破裂，需要专业人员上门维修。位置在二楼厨房水池下方，水已经关闭。', 'pipe_leak_1.jpg,pipe_leak_2.jpg', '2025-06-15 09:00:00', 0),
('周末需要家庭保洁服务', 3, 1, 110100, '三室两厅，约120平米，需要全屋深度清洁。包括地板、家具、厨房油污等。预计需要4-5小时。', 'room_photo_1.jpg,room_photo_2.jpg', '2025-07-20 10:30:00', 0),
('老人需要日常起居照料', 2, 1, 110100, '70岁老人，身体健康但行动不便，需要每天上午2小时的照料服务。包括做饭、打扫卫生、陪同购物等。', 'elderly_profile.txt', '2025-08-01 14:00:00', 0),
('求助：陪同看医生', 4, 1, 110100, '年迈父亲需要到医院做体检和咨询，需要陪同和翻译（医学术语）。地点在北京友谊医院。', 'medical_report.pdf', '2025-09-05 11:00:00', -1),

-- 用户2（李四）发布3条需求
(user_li, '每日午饭和晚饭配送', 5, 310100, '工作太忙，需要每天12:00和18:00送餐到公司。餐食要求：清淡、营养、热的。可按周支付。', 'company_location.txt', '2025-06-20 08:00:00', 0),
('需要定期接送上班', 6, 2, 310100, '每工作日早7:30从家里接，晚17:30从公司送回。地点：浦东新区。长期合作。', 'work_address.txt', '2025-07-10 09:00:00', 0),
('浴室防水补漏', 1, 2, 310100, '浴室防水有问题，长期渗水，需要专业防水处理。预计2-3天完成。', 'bathroom_photo.jpg', '2025-08-15 13:00:00', -1),

-- 用户3（王五）发布2条需求
('办公室保洁维护', 3, 3, 440100, '每周2次办公室深度清洁，500平米空间，15人办公。要求：环保清洁剂、早6点前完成。', 'office_layout.pdf', '2025-07-05 10:00:00', 0),
('搬家打包整理服务', 3, 3, 440100, '3居室，需要专业打包整理，大约200箱。需要2-3天时间，有专业搬家经验优先。', 'room_size.txt', '2025-09-01 15:00:00', 0),

-- 用户4（赵六）发布2条需求
('健身房家教课程', 2, 4, 440300, '需要家教式的老年人健身指导，每周3次，45分钟/次。地点：小区活动室。', 'fitness_space.txt', '2025-06-25 14:00:00', 0),
('养生食疗咨询', 5, 4, 440300, '70岁，想了解养生食疗知识，需要专业营养师咨询。最好能上门制定食谱。', 'health_records.pdf', '2025-08-10 10:00:00', 0),

-- 用户5（孙七）发布1条需求
('中医理疗咨询', 4, 5, 330100, '腰椎间盘突出，想了解中医理疗方案。需要专业医生在线咨询，最好能上门评估。', 'medical_imaging.pdf', '2025-08-20 11:30:00', 0);

-- ============================================
-- 5. 创建服务响应记录（15条）
-- ============================================
-- 说明：
-- - response_userid：响应用户ID
-- - sr_id：对应的服务需求ID
-- - response_state：0=待接受，1=已接受，2=已拒绝，3=已取消
-- - response_date：响应时间
-- - file_list：资质证书、案例等文件

-- 需求1（厨房水管维修）的3个响应
INSERT INTO response_info
(response_userid, sr_id, title, `desc`, response_date, response_state, file_list, update_date) VALUES
(2, 1, '专业水管维修，30分钟上门', '持证水管工，从业10年，工具齐全，价格透明。保证一年内再次漏水免费维修。', '2025-06-15 10:15:00', 1, 'water_license.jpg,tools_photo.jpg,case1.jpg', '2025-06-15 16:30:00'),
(2, 1, '24小时应急维修服务', '我们公司承接大小管道维修，有应急车队，30分钟内到达北京任何地点。电话随时接听。', '2025-06-15 11:00:00', 0, 'company_cert.jpg,truck_photo.jpg', NULL),
(2, 1, '附近维修工，价格便宜', '我住在你家附近，有20年管道经验。报价100元/小时，材料另算。有需要随时可上门。', '2025-06-15 12:30:00', 2, 'experience_cert.jpg', '2025-06-15 14:00:00'),

-- 需求2（家庭保洁）的2个响应
(3, 2, '五星级保洁服务', '专业保洁团队，有5年家政服务经验。使用环保清洁剂，价格合理。提供满意度保证。', '2025-07-20 11:45:00', 1, 'team_photo.jpg,cert_photo.jpg,customer_reviews.pdf', '2025-07-20 14:20:00'),
(3, 2, '家政保洁外包', '我们专业承接家庭保洁、定期维护。有专业培训的保洁员，工作细致认真。可上门估价。', '2025-07-20 13:00:00', 0, 'company_license.jpg,team_training.jpg', NULL),

-- 需求3（老人照料）的3个响应
(4, 3, '资深养老护理员', '我是注册护理员，有8年以上老年照料经验。可做饭、清洁、陪伴，价格按小时算。', '2025-08-01 15:30:00', 1, 'nursing_license.jpg,age_check.jpg,reference_letters.pdf', '2025-08-02 09:00:00'),
(4, 3, '家庭护理服务中心', '我们有专业的护理团队，可长期或短期上门护理。护理员都经过专业培训，价格透明。', '2025-08-01 16:45:00', 0, 'center_license.jpg,staff_certs.jpg,service_agreement.pdf', NULL),
(4, 3, '私人护理助手', '本人专业做老年陪护，有爱心、有耐心。做饭手艺好，卫生意识强。诚心为老人服务。', '2025-08-02 10:00:00', 0, 'identity_card.jpg,health_cert.jpg', NULL),

-- 需求5（午晚饭配送）的2个响应
(4, 5, '营养师定制健康餐', '由营养师设计菜谱，每天新鲜配送。可根据口味调整，价格25元/餐。上海快递24小时。', '2025-06-20 09:30:00', 1, 'nutrition_cert.jpg,menu_samples.jpg,delivery_track.pdf', '2025-06-22 11:00:00'),
(5, 5, '便当外卖快餐', '我们是连锁快餐店，支持定期配送。价格便宜，12块/个快餐盒。配送范围覆盖浦东。', '2025-06-20 10:15:00', 0, 'business_license.jpg,delivery_fleet.jpg', NULL),

-- 需求6（接送上班）的2个响应
(2, 6, '专业接送司机', '有10年驾龄，熟悉浦东路线，开车平稳安全。有营运证，长期可靠。时间准时。', '2025-07-10 10:00:00', 1, 'driver_license.jpg,vehicle_cert.jpg,insurance.pdf', '2025-07-11 08:30:00'),
(3, 6, '车队接送服务', '我们提供企业员工班车接送服务。有多辆车，可按需安排。价格按月计费。', '2025-07-10 11:30:00', 0, 'fleet_license.jpg,company_profile.jpg,contract_sample.pdf', NULL),

-- 需求8（办公室保洁）的2个响应
(3, 8, '物业保洁承包', '承接商业保洁，有专业保洁团队10人以上。可长期日常保洁，价格优惠。', '2025-07-05 11:15:00', 1, 'company_license.jpg,team_photo.jpg,service_record.pdf', '2025-07-06 09:00:00'),
(5, 8, '家政保洁分公司', '本分公司承接办公场所保洁维护，经验丰富，价格从优。可上门洽谈合同。', '2025-07-05 13:45:00', 0, 'branch_license.jpg,service_samples.jpg', NULL),

-- 需求10（健身指导）的1个响应
(2, 10, '老年健身教练', '我是认证健身教练，专业指导老年人运动。动作简单有效，安全至上。收费便宜。', '2025-06-25 15:30:00', 1, 'fitness_cert.jpg,experience_proof.jpg', '2025-06-26 14:00:00');

-- ============================================
-- 6. 创建服务达成记录（5条）
-- ============================================
-- 说明：
-- - srid：服务需求ID
-- - response_id：被接受的响应ID
-- - psr_userid：需求发布者ID
-- - response_userid：响应提供者ID
-- - createdate：服务达成日期（通常是响应被接受后）
-- - desc：备注描述

INSERT INTO accept_info
(srid, psr_userid, response_id, response_userid, createdate, `desc`) VALUES
(1, 1, 1, 2, '2025-06-15 16:00:00', '李四准时上门，专业高效，水管问题当场解决'),
(2, 1, 4, 3, '2025-07-20 14:00:00', '王五的团队工作认真，卫生做得很到位，非常满意'),
(3, 1, 6, 4, '2025-08-01 17:30:00', '赵六照顾周到，得到老人喜爱，已签长期协议'),
(5, 2, 11, 4, '2025-06-22 12:30:00', '营养餐美味健康，老父亲很满意，继续订购'),
(6, 2, 12, 2, '2025-07-11 09:00:00', '李四司机准时可靠，安全驾驶，长期合作');

-- ============================================
-- 7. 创建月度统计数据（6个月）
-- ============================================
-- 说明：
-- - monthID：统计月份（格式YYYYMM）
-- - stype_id：服务类型ID
-- - cityID：城市ID
-- - ps_num：该月发布的服务需求数
-- - rs_num：该月成功完成的服务数

INSERT INTO report
(monthID, stype_id, cityID, ps_num, rs_num) VALUES
-- 2025年06月统计
('202506', 1, 110100, 8, 5),
('202506', 2, 110100, 5, 3),
('202506', 3, 110100, 6, 4),
('202506', 4, 110100, 3, 2),
('202506', 5, 310100, 7, 5),
('202506', 6, 310100, 4, 3),

-- 2025年07月统计
('202507', 1, 110100, 10, 7),
('202507', 2, 110100, 6, 4),
('202507', 3, 110100, 8, 6),
('202507', 4, 110100, 4, 2),
('202507', 5, 310100, 9, 7),
('202507', 6, 310100, 5, 4),
('202507', 3, 440100, 12, 9),

-- 2025年08月统计
('202508', 1, 110100, 12, 8),
('202508', 2, 110100, 8, 5),
('202508', 3, 110100, 10, 7),
('202508', 4, 110100, 5, 3),
('202508', 5, 310100, 11, 8),
('202508', 6, 310100, 6, 5),
('202508', 3, 440100, 14, 11),
('202508', 2, 440300, 9, 6),

-- 2025年09月统计
('202509', 1, 110100, 14, 10),
('202509', 2, 110100, 10, 7),
('202509', 3, 110100, 12, 9),
('202509', 4, 110100, 6, 4),
('202509', 5, 310100, 13, 10),
('202509', 6, 310100, 7, 6),
('202509', 3, 440100, 16, 13),
('202509', 2, 440300, 11, 8),
('202509', 4, 330100, 8, 5),

-- 2025年10月统计
('202510', 1, 110100, 16, 12),
('202510', 2, 110100, 12, 9),
('202510', 3, 110100, 14, 11),
('202510', 4, 110100, 7, 5),
('202510', 5, 310100, 15, 12),
('202510', 6, 310100, 8, 7),
('202510', 3, 440100, 18, 15),
('202510', 2, 440300, 13, 10),
('202510', 4, 330100, 10, 7),

-- 2025年11月统计（迄今）
('202511', 1, 110100, 18, 13),
('202511', 2, 110100, 14, 10),
('202511', 3, 110100, 16, 12),
('202511', 4, 110100, 8, 6),
('202511', 5, 310100, 17, 13),
('202511', 6, 310100, 9, 8),
('202511', 3, 440100, 20, 16),
('202511', 2, 440300, 15, 12),
('202511', 4, 330100, 12, 9);

-- ============================================
-- 8. 数据验证与统计
-- ============================================
-- 显示导入的数据概览

SELECT '=== GoodServices 测试数据导入统计 ===' AS status;
SELECT CONCAT('用户总数: ', COUNT(*)) AS metric FROM buser_table;
SELECT CONCAT('服务需求总数: ', COUNT(*)) AS metric FROM sr_info;
SELECT CONCAT('  - 已发布: ', SUM(CASE WHEN ps_state = 0 THEN 1 ELSE 0 END)) AS status FROM sr_info;
SELECT CONCAT('  - 已取消: ', SUM(CASE WHEN ps_state = -1 THEN 1 ELSE 0 END)) AS status FROM sr_info;
SELECT CONCAT('服务响应总数: ', COUNT(*)) AS metric FROM response_info;
SELECT CONCAT('  - 待接受: ', SUM(CASE WHEN response_state = 0 THEN 1 ELSE 0 END)) AS status FROM response_info;
SELECT CONCAT('  - 已接受: ', SUM(CASE WHEN response_state = 1 THEN 1 ELSE 0 END)) AS status FROM response_info;
SELECT CONCAT('  - 已拒绝: ', SUM(CASE WHEN response_state = 2 THEN 1 ELSE 0 END)) AS status FROM response_info;
SELECT CONCAT('服务达成记录数: ', COUNT(*)) AS metric FROM accept_info;
SELECT CONCAT('统计记录总数: ', COUNT(*)) AS metric FROM report;

SELECT '=== 数据导入完成 ===' AS status;

-- ============================================
-- 数据导入完成
-- ============================================
-- 已导入的测试数据：
-- ✓ 5个测试用户（服务消费者 + 服务提供者）
-- ✓ 12条服务需求（4种状态分布）
-- ✓ 15条服务响应（3种响应状态分布）
-- ✓ 5条服务达成记录（完整业务流程）
-- ✓ 近6个月月度统计数据（支持数据可视化）
--
-- 测试覆盖范围：
-- - 用户管理：注册用户验证
-- - 服务需求：发布、查询、统计
-- - 服务响应：多响应响应、状态流转
-- - 服务撮合：需求和响应匹配、达成记录
-- - 数据统计：按时间、城市、类型的统计
--
-- 业务流程示例：
-- 1. 张三（user_zhang）发布"厨房水管维修"需求
-- 2. 李四（user_li）响应此需求
-- 3. 张三接受李四的响应，服务达成
-- 4. 系统记录此次服务，月度统计数据+1
--
-- 密码说明：
-- - 所有用户密码都是 Pass123
-- - BCrypt加密值：$2b$12$LQv3c1yqBWVHxkd0LHAkCOYz6TtxMQJqhN8/LewY5lW5q3Zm3qXHu
-- ============================================

SET FOREIGN_KEY_CHECKS = 1;
